var container=d3.select("#scroll"),graphic=container.select(".scroll__graphic"),chart=graphic.select(".chart"),text=container.select(".scroll__text"),step=text.selectAll(".step"),scroller=scrollama(),_data=six.minutes,sixPM=[];_data.forEach(t=>{var e;e="0"===t.minute.charAt(0)?"0"+parseInt(t.minute.charAt(1)):parseInt(t.minute.substring(0,2)),sixPM.push({hour:"6",minute:e,avg:t.per_second,words:t.words})}),_data=seven.minutes;var sevenPM=[];_data.forEach(t=>{var e;e="0"===t.minute.charAt(0)?"0"+parseInt(t.minute.charAt(1)):parseInt(t.minute.substring(0,2)),sevenPM.push({hour:"7",minute:e,avg:t.per_second,words:t.words})}),_data=eight.minutes;var eightPM=[];_data.forEach(t=>{var e;e="0"===t.minute.charAt(0)?"0"+parseInt(t.minute.charAt(1)):parseInt(t.minute.substring(0,2)),eightPM.push({hour:"8",minute:e,avg:t.per_second,words:t.words})}),_data=nine.minutes;var canvas,active,bar,p,ninePM=[];function handleResize(){var t=Math.floor(.7*window.innerHeight);step.style("height",t+"px");var e=d3.select("body").node().offsetWidth-text.node().offsetWidth;graphic.style("width",e+"px").style("height",window.innerHeight+"px");var r=graphic.node().offsetWidth-32,a=graphic.node().offsetHeight-32;chart.style("width",r+"px").style("height",a+"px"),scroller.resize()}_data.forEach(t=>{var e;e="0"===t.minute.charAt(0)?"0"+parseInt(t.minute.charAt(1)):parseInt(t.minute.substring(0,2)),ninePM.push({hour:"9",minute:e,avg:t.per_second,words:t.words})}),window.onbeforeunload=function(){window.scrollTo(0,0)};var previous=0,current=0;function handleStepEnter(t){step.classed("is-active",function(e,r){return r===t.index}),previous=current,0===(current=t.index)?reset():1===current?tooltip(32):2===current?tooltip(42):3===current?tooltip(50):4===current?tooltip(53):5===current?tooltip(54):6===current?tooltip(58):7===current?6===previous?reset():update(sixPM):8===current?7===previous?update(sevenPM):reset():9===current?tooltip(13):10===current?tooltip(15):11===current?tooltip(19):12===current?tooltip(27):13===current?tooltip(43):14===current?tooltip(49):15===current?14===previous?reset():update(sevenPM):16===current?15===previous?update(eightPM):reset():17===current?tooltip(36):18===current?tooltip(58):19===current?18===previous?reset():update(eightPM):20===current?19===previous?update(ninePM):reset():21===current?tooltip(20):22===current?tooltip(29):23===current?tooltip(36):24===current?tooltip(43):25===current&&tooltip(56)}function tooltip(t){svg.selectAll(".dot").filter(function(e){e.minute===t?d3.select(this).transition().ease(d3.easeBack).attr("fill",d3.select(this).attr("stroke")).attr("fill-opacity","0.4").attr("r",30).duration(1e3):d3.select(this).transition().ease(d3.easeBack).attr("fill","transparent").attr("r",4).duration(1e3)})}function reset(){svg.selectAll(".dot").filter(function(t){d3.select(this).transition().ease(d3.easeBack).attr("fill","transparent").attr("r",4).duration(1e3)})}function setupStickyfill(){d3.selectAll(".sticky").each(function(){Stickyfill.add(this)})}function init(){setupStickyfill(),handleResize(),scroller.setup({container:"#scroll",graphic:".scroll__graphic",text:".scroll__text",step:".scroll__text .step",debug:!1}).onStepEnter(handleStepEnter),window.addEventListener("resize",handleResize)}init();var svg=d3.select("#canvas");chart=d3.select(".chart");svg.attr("width",parseInt(chart._groups[0][0].style.width)),svg.attr("height",parseInt(chart._groups[0][0].style.height));var margin={top:75,right:50,bottom:100,left:50},width=svg.attr("width")-margin.left-margin.right,height=svg.attr("height")-margin.top-margin.bottom,g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),x=d3.scaleLinear().range([0,width]),y=d3.scaleLinear().range([height,0]),xAxisCall=d3.axisBottom(x),xAxis=g.append("g").attr("class","x-axis").attr("transform","translate(0,"+height+")"),yAxisCall=d3.axisLeft(y),yAxis=g.append("g").attr("class","y-axis");function make_y_gridlines(){return d3.axisLeft(y).ticks(5)}function update(t){d3.select(".line").remove(),d3.select(".grid").remove();var e=d3.transition().duration(900);x.domain([0,59]),y.domain([5,40]),xAxis.transition(e).call(xAxisCall),yAxis.transition(e).call(yAxisCall),g.append("g").attr("class","grid").call(make_y_gridlines().tickSize(-width).tickFormat(""));var r=g.selectAll(".dot").data(t);r.exit().transition(e).attr("fill-opacity",.1).attr("cy",y(0)).remove(),r.transition(e).attr("cx",function(t){return x(t.minute)}).attr("cy",function(t){return y(t.avg)}).attr("stroke",function(t){return t.avg>5&&t.avg<=10?"#5AC6B0":t.avg>10&&t.avg<=15?"#58B7B7":t.avg>15&&t.avg<=20?"#62ACC4":t.avg>20&&t.avg<=25?"#6A8FDB":t.avg>25&&t.avg<=30?"#788AE9":t.avg>30&&t.avg<=35?"#8987E1":t.avg>35&&t.avg<=40?"#BA8ED3":void 0}).attr("fill","transparent").attr("r",4),r.enter().append("circle").attr("class","dot").attr("cx",function(t){return x(t.minute)}).attr("cy",y(0)).attr("r",4).attr("stroke",function(t){return t.avg>5&&t.avg<=10?"#5AC6B0":t.avg>10&&t.avg<=15?"#58B7B7":t.avg>15&&t.avg<=20?"#62ACC4":t.avg>20&&t.avg<=25?"#6A8FDB":t.avg>25&&t.avg<=30?"#788AE9":t.avg>30&&t.avg<=35?"#8987E1":t.avg>35&&t.avg<=40?"#BA8ED3":void 0}).attr("stroke-width",2).attr("fill","transparent").on("mouseover",function(t){(active=d3.select(".is-active"))._groups[0][0].childNodes.forEach(t=>{"p"===t.localName&&(p=t)}),active._groups[0][0].removeChild(p);var e=document.createElement("canvas");e.width=active._groups[0][0].style.width-5,e.height=active._groups[0][0].style.height-5,active._groups[0][0].append(e),new Chart(e,{type:"polarArea",data:{labels:[t.words[0].text,t.words[1].text,t.words[2].text],datasets:[{backgroundColor:["rgba(186, 142, 211, 0.75)","rgba(106, 143, 219, 0.75)","rgba(90, 198, 176, 0.75)"],data:[t.words[0].count,t.words[1].count,t.words[2].count]}]},options:{title:{display:!0,text:"Top 3 Mentions - "+t.hour+":"+t.minute+" PM"}}})}).on("mouseout",function(){active._groups[0][0].childNodes.forEach(t=>{"canvas"===t.localName&&(canvas=t)}),active._groups[0][0].removeChild(canvas),active._groups[0][0].append(p)}).transition(e).attr("fill-opacity",1).attr("cy",function(t){return y(t.avg)})}xAxis.append("text").attr("class","axis-title").attr("transform","translate("+width+", 0)").attr("fill","#2c3e50").attr("x",-16).attr("y",-6).text("Minute"),yAxis.append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y",16).attr("x",-4).attr("fill","#2c3e50").text("Tweets Per Second"),update(sixPM);
